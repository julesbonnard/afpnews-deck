matrix:
  include:
    - os: osx
      osx_image: xcode9.3
      language: node_js
      node_js: "8"
      env:
        - ELECTRON_CACHE=$HOME/.cache/electron
        - ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder

cache:
  directories:
    - node_modules
    - $HOME/.cache/electron
    - $HOME/.cache/electron-builder

install:
- npm install

script:
- npm run build
- npm run dist

before_cache:
  - rm -rf $HOME/.cache/electron-builder/wine

after_deploy:
  - rm -rf dist/afpNewsDeck-* dist/mac dist/icons dist/.icon-icns dist/github dist/electron-builder-effective-config.yaml dist/afpnews-deck.electron.js

deploy:
  - provider: releases
    api-key: "$GITHUB_TOKEN"
    file-glob: true
    file: "dist/afpNewsDeck-*.*"
    skip-cleanup: true
    on:
      repo: julesbonnard/afpnews-deck
      branch: master
      tags: true
  - provider: pages
    skip-cleanup: true
    github-token: "$GITHUB_TOKEN"
    keep-history: true
    local-dir: dist
    on:
      repo: julesbonnard/afpnews-deck
      branch: master
      tags: true
